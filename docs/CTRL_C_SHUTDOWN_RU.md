# ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ Ctrl+C

## üéØ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ **graceful shutdown** –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Ctrl+C:

1. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤** –≤ `main.py`
2. ‚úÖ **–ú–µ—Ç–æ–¥ cleanup** –≤ `FileSystemAgent` –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
3. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ KeyboardInterrupt** –≤ `rich_chat.py`
4. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ CancelledError** –≤ `agent.py`

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. `main.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤

```python
def signal_handler(sig, frame):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è graceful shutdown"""
    print("\n‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (Ctrl+C). –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≥–µ–Ω—Ç–∞...")
    shutdown_event.set()
    raise KeyboardInterrupt

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
if sys.platform != "win32":
    signal.signal(signal.SIGINT, signal_handler)
    signal.signal(signal.SIGTERM, signal_handler)
else:
    signal.signal(signal.SIGINT, signal_handler)
    if hasattr(signal, 'SIGBREAK'):
        signal.signal(signal.SIGBREAK, signal_handler)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç Ctrl+C (SIGINT)
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–ª–∞–≥ shutdown
- –ü–æ–¥–Ω–∏–º–∞–µ—Ç KeyboardInterrupt –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ asyncio

### 2. `agent.py` - –ú–µ—Ç–æ–¥ cleanup

```python
async def cleanup(self):
    """–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –∞–≥–µ–Ω—Ç–∞ –∏ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤"""
    logger.info("üßπ –ù–∞—á–∞–ª–æ cleanup –∞–≥–µ–Ω—Ç–∞...")
    
    # –ó–∞–∫—Ä—ã–≤–∞–µ–º MCP –∫–ª–∏–µ–Ω—Ç
    if self.mcp_client:
        if hasattr(self.mcp_client, 'aclose'):
            await self.mcp_client.aclose()
        elif hasattr(self.mcp_client, 'close'):
            await self.mcp_client.close()
    
    # –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    if self.context_manager:
        self.context_manager.clear_context(keep_stats=True)
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ MCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –û—á–∏—â–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É)
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å cleanup

### 3. `rich_chat.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

```python
try:
    async for chunk in self.agent.process_message(...):
        # –æ–±—Ä–∞–±–æ—Ç–∫–∞ chunk
except KeyboardInterrupt:
    self.console.print("\n‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)")
    raise
except asyncio.CancelledError:
    self.console.print("\n‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞")
    raise
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç KeyboardInterrupt –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–∞–ª—å—à–µ –¥–ª—è cleanup

### 4. `agent.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ CancelledError

```python
except asyncio.CancelledError:
    # –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)
    logger.info("üõë –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    yield {"error": "üõë –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)"}
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç–º–µ–Ω—É –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–µ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –õ–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ

---

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞

```
–í—ã: –ø—Ä–æ–≤–µ—Ä—å 192.168.0.4
–ê–≥–µ–Ω—Ç: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç nmap...]
üíì Heartbeat: –æ–ø–µ—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞ (10.2—Å)

[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç Ctrl+C]

‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (Ctrl+C). –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≥–µ–Ω—Ç–∞...
‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)
üßπ –ù–∞—á–∞–ª–æ cleanup –∞–≥–µ–Ω—Ç–∞...
‚úÖ MCP –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω
‚úÖ Cleanup –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (–ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –≤–≤–æ–¥–∞

```
–í—ã: [–æ–∂–∏–¥–∞–Ω–∏–µ –≤–≤–æ–¥–∞]

[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç Ctrl+C]

‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (Ctrl+C). –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≥–µ–Ω—Ç–∞...
üßπ –ù–∞—á–∞–ª–æ cleanup –∞–≥–µ–Ω—Ç–∞...
‚úÖ MCP –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω
üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (–ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```
[bold green]Initializing Gemini Agent...[/bold green]

[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç Ctrl+C]

‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (Ctrl+C). –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≥–µ–Ω—Ç–∞...
üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (–ø—Ä–µ—Ä–≤–∞–Ω–æ)
```

---

## üìä –ß—Ç–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ cleanup

### 1. MCP –ö–ª–∏–µ–Ω—Ç
- –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å MCP —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- –ü–æ–¥–ø—Ä–æ—Ü–µ—Å—Å—ã MCP —Å–µ—Ä–≤–µ—Ä–æ–≤ (stdio)
- –ë—É—Ñ–µ—Ä—ã –∏ –∫—ç—à–∏

### 2. –ö–æ–Ω—Ç–µ–∫—Å—Ç
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π (–æ—á–∏—â–∞–µ—Ç—Å—è)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
- –ö—ç—à–∏ —Å—Ö–æ–∂–µ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

### 3. –†–µ—Å—É—Ä—Å—ã
- Event loop –∑–∞–¥–∞—á–∏
- –¢–∞–π–º–∞—É—Ç—ã –∏ watchdog
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚ùå Ctrl+C ‚Üí –∑–∞–≤–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
‚ùå MCP –ø–æ–¥–ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤–∏—Å–µ—Ç—å
‚ùå –ù–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
‚ùå –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —É–±–∏–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —á–µ—Ä–µ–∑ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚úÖ Ctrl+C ‚Üí graceful shutdown
‚úÖ MCP –ø–æ–¥–ø—Ä–æ—Ü–µ—Å—Å—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
‚úÖ –ü–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ cleanup
```

---

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ cleanup —Ä–∞–±–æ—Ç–∞–µ—Ç:

#### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≥–µ–Ω—Ç–∞
```bash
python main.py
```

#### 2. –ù–∞—á–Ω–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
```
–í—ã: –ø—Ä–æ–≤–µ—Ä—å 192.168.0.4
```

#### 3. –ù–∞–∂–º–∏—Ç–µ Ctrl+C –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

#### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
```bash
tail -f ai_agent.log | grep -E "cleanup|–ø—Ä–µ—Ä–≤–∞–Ω–æ|MCP"
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
üßπ –ù–∞—á–∞–ª–æ cleanup –∞–≥–µ–Ω—Ç–∞...
‚úÖ MCP –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω
‚úÖ Cleanup –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ
üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (–ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è:

#### Windows:
```powershell
# –î–û Ctrl+C
tasklist | findstr -i "python node"

# –ü–æ—Å–ª–µ Ctrl+C (—á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã)
tasklist | findstr -i "python node"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```

#### Linux/Mac:
```bash
# –î–û Ctrl+C
ps aux | grep -E "python|node" | grep -v grep

# –ü–æ—Å–ª–µ Ctrl+C
ps aux | grep -E "python|node" | grep -v grep
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–µ–Ω—å—à–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: Cleanup –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- Ctrl+C –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤–∏—Å–µ—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –µ—Å—Ç—å finally –±–ª–æ–∫ –≤ main()
try:
    await chat.run()
except KeyboardInterrupt:
    ...
finally:
    await agent.cleanup()  # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–¥–µ—Å—å!
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: MCP –ø–æ–¥–ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- Python –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–∫—Ä—ã–ª—Å—è
- –ù–æ node.exe –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ cleanup –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ mcp_client –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ close/aclose
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –û—à–∏–±–∫–∞ –ø—Ä–∏ cleanup

**–°–∏–º–ø—Ç–æ–º—ã:**
- –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ cleanup
- –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**
```python
# Cleanup –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ try/except
try:
    await agent.cleanup()
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ cleanup: {e}")
    # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–∞–∂–µ –µ—Å–ª–∏ cleanup —É–ø–∞–ª
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] **Ctrl+C –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞**
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞"
  - [ ] Cleanup –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
  - [ ] MCP –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
  - [ ] –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

- [ ] **Ctrl+C –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ –≤–≤–æ–¥–∞**
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"
  - [ ] Cleanup –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
  - [ ] –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

- [ ] **Ctrl+C –≤–æ –≤—Ä–µ–º—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**
  - [ ] –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏
  - [ ] –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**
  - [ ] –ü–æ—Å–ª–µ Ctrl+C –Ω–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö Python –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
  - [ ] –ü–æ—Å–ª–µ Ctrl+C –Ω–µ—Ç –∑–∞–≤–∏—Å—à–∏—Ö Node.js –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (MCP —Å–µ—Ä–≤–µ—Ä—ã)

- [ ] **–õ–æ–≥–∏**
  - [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏ –æ cleanup
  - [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–∏ cleanup
  - [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

---

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –¥–æ–ª–≥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

```python
# –ê–≥–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ–ª–≥—É—é –∫–æ–º–∞–Ω–¥—É
–í—ã: –Ω–∞–π–¥–∏ –≤—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫–µ C:

–ê–≥–µ–Ω—Ç: [–≤—ã–ø–æ–ª–Ω—è–µ—Ç...]
üíì Heartbeat: –æ–ø–µ—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞ (10.2—Å)
üíì Heartbeat: –æ–ø–µ—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞ (20.5—Å)

[Ctrl+C]

‚ö†Ô∏è –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–µ—Ä–≤–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (Ctrl+C)
üßπ –ù–∞—á–∞–ª–æ cleanup –∞–≥–µ–Ω—Ç–∞...
‚úÖ MCP –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω
üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (–ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
```

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –≤ –æ–∂–∏–¥–∞–Ω–∏–∏

```python
# –ê–≥–µ–Ω—Ç –∂–¥–µ—Ç –≤–≤–æ–¥–∞
üí¨ You: 

[Ctrl+C]

‚ö†Ô∏è  –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (Ctrl+C). –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≥–µ–Ω—Ç–∞...
üßπ –ù–∞—á–∞–ª–æ cleanup –∞–≥–µ–Ω—Ç–∞...
‚úÖ MCP –∫–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä—ã—Ç
‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—á–∏—â–µ–Ω
üèÅ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã (–ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º)
```

---

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ Python

**Windows:**
- `SIGINT` - Ctrl+C
- `SIGBREAK` - Ctrl+Break (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

**Unix/Linux/Mac:**
- `SIGINT` - Ctrl+C
- `SIGTERM` - kill command

### Asyncio –∏ —Å–∏–≥–Ω–∞–ª—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–ª—å–∑—è –≤—ã–∑—ã–≤–∞—Ç—å async —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–Ω–∏–º–∞–µ–º `KeyboardInterrupt` –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –µ–≥–æ –≤ async –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.

### Cleanup –ø–æ—Ä—è–¥–æ–∫

1. **–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - CancelledError
2. **–ó–∞–∫—Ä—ã—Ç–∏–µ MCP –∫–ª–∏–µ–Ω—Ç–∞** - –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
3. **–û—á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –∑–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

---

## üÜò –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ main.py
grep -n "signal_handler" main.py
grep -n "cleanup" main.py

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ agent.py
grep -n "async def cleanup" smart_gemini_agent/core/agent.py
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
tail -f ai_agent.log | grep -E "cleanup|–ø—Ä–µ—Ä–≤–∞–Ω–æ|KeyboardInterrupt"
```

### 3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

–ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# Windows
taskkill /F /IM python.exe
taskkill /F /IM node.exe

# Linux/Mac
pkill -9 python
pkill -9 node
```

---

## ‚úÖ –ò—Ç–æ–≥–∏

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ **–ø–æ–ª–Ω–æ–µ graceful shutdown**:

- ‚úÖ Ctrl+C –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- ‚úÖ MCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
- ‚úÖ –†–µ—Å—É—Ä—Å—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è
- ‚úÖ –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows –∏ Unix

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

---

**–î–∞—Ç–∞:** 2025-11-03  
**–í–µ—Ä—Å–∏—è:** v4.0-graceful-shutdown  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≥–µ–Ω—Ç–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ Ctrl+C!

